<!-- extension/ui/sidepanel.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astra QA - AI Design Quality Assurance</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="qa-panel">
    <!-- Enhanced Header with Astra QA branding -->
    <header class="qa-header">
      <div class="qa-header-content">
        <h1 class="qa-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12,2 22,8.5 22,15.5 12,22 2,15.5 2,8.5"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          Astra QA
          <span class="qa-ai-badge" id="ai-status-badge">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7v10c0 5.55 3.84 10 9 11 5.16-1 9-5.45 9-11V7l-10-5z"/>
              <path d="M9 12l2 2 4-4"/>
            </svg>
            AI
          </span>
          <span class="qa-deployment-badge" id="deployment-indicator">‚ö° Vercel</span>
        </h1>
        <div class="qa-header-controls">
          <button id="ai-settings" class="qa-btn qa-btn-ghost" title="Astra QA Settings">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
            </svg>
          </button>
          <button id="start-analysis" class="qa-btn qa-btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 6l4-4 4 4"/>
              <path d="M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22"/>
            </svg>
            Analyze Page
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="qa-main">
      <!-- Loading State -->
      <div id="loading-state" class="qa-loading hidden">
        <div class="qa-spinner"></div>
        <p id="loading-message">Astra QA analyzing page...</p>
        <div class="qa-loading-steps">
          <div class="qa-step active" data-step="basic">
            <span class="qa-step-icon">üîç</span>
            <span>Basic Analysis</span>
          </div>
          <div class="qa-step" data-step="ai">
            <span class="qa-step-icon">‚ú®</span>
            <span>AI Enhancement</span>
          </div>
        </div>
      </div>

      <!-- Welcome State -->
      <div id="welcome-state" class="qa-welcome">
        <div class="qa-welcome-content">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polygon points="12,2 22,8.5 22,15.5 12,22 2,15.5 2,8.5"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          <h2>Astra QA</h2>
          <p>AI-powered design quality assurance with intelligent insights, contextual recommendations, and business impact analysis powered by Claude AI.</p>
          <div class="qa-features">
            <div class="qa-feature">
              <span class="qa-feature-icon">‚ú®</span>
              <span>AI Analysis</span>
            </div>
            <div class="qa-feature">
              <span class="qa-feature-icon">üéØ</span>
              <span>Smart Insights</span>
            </div>
            <div class="qa-feature">
              <span class="qa-feature-icon">üöÄ</span>
              <span>Quality Assurance</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Results State -->
      <div id="results-state" class="qa-results hidden">
        <!-- Enhanced Summary with AI insights -->
        <div class="qa-summary">
          <div class="qa-summary-stats">
            <div class="qa-stat">
              <span class="qa-stat-number" id="total-issues">0</span>
              <span class="qa-stat-label">Total Issues</span>
            </div>
            <div class="qa-stat">
              <span class="qa-stat-number" id="ai-score">-</span>
              <span class="qa-stat-label">Quality Score</span>
            </div>
            <div class="qa-stat">
              <span class="qa-stat-number" id="critical-issues">0</span>
              <span class="qa-stat-label">Critical</span>
            </div>
          </div>
          
          <!-- AI Status Indicator -->
          <div class="qa-ai-status" id="ai-analysis-status">
            <div class="qa-ai-status-basic">
              <span class="qa-status-icon">‚úÖ</span>
              <span>Basic analysis complete</span>
            </div>
            <div class="qa-ai-status-ai" id="ai-status-indicator">
              <div class="qa-spinner-small"></div>
              <span>Astra QA analyzing insights...</span>
            </div>
          </div>
        </div>

        <!-- AI Insights Panel -->
        <div id="ai-insights-panel" class="qa-ai-insights hidden">
          <div class="qa-section-header">
            <h3>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12,2 22,8.5 22,15.5 12,22 2,15.5 2,8.5"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              Astra QA Insights
            </h3>
            <button id="toggle-ai-insights" class="qa-btn qa-btn-secondary">Hide</button>
          </div>
          
          <div class="qa-ai-content">
            <!-- Quick Wins -->
            <div class="qa-insight-section">
              <h4>üöÄ Quick Wins</h4>
              <div id="quick-wins-list" class="qa-quick-wins"></div>
            </div>
            
            <!-- Business Impact -->
            <div class="qa-insight-section">
              <h4>üíº Business Impact</h4>
              <div id="business-impact" class="qa-business-impact"></div>
            </div>
            
            <!-- Design Coaching -->
            <div class="qa-insight-section">
              <h4>üéì Design Coaching</h4>
              <div id="design-coaching" class="qa-design-coaching"></div>
            </div>
          </div>
        </div>

        <!-- Screenshot Section -->
        <div class="qa-screenshot-section">
          <div class="qa-section-header">
            <h3>Page Screenshot</h3>
            <div class="qa-screenshot-controls">
              <button id="toggle-markers" class="qa-btn qa-btn-secondary">
                Hide Markers
              </button>
              <button id="capture-screenshot" class="qa-btn qa-btn-secondary">
                üì∏ Recapture
              </button>
            </div>
          </div>
          <div class="qa-screenshot-container">
            <img id="page-screenshot" src="" alt="Page screenshot" class="qa-screenshot">
            <div class="qa-screenshot-overlay" id="screenshot-overlay"></div>
          </div>
        </div>

        <!-- Enhanced Issues Section -->
        <div class="qa-issues-section">
          <div class="qa-section-header">
            <h3>Issues Found</h3>
            <div class="qa-issue-controls">
              <div class="qa-issue-filters">
                <button class="qa-filter active" data-type="all">All</button>
                <button class="qa-filter" data-type="token">Tokens</button>
                <button class="qa-filter" data-type="component">Components</button>
                <button class="qa-filter" data-type="ai_detected">AI Found</button>
              </div>
              <div class="qa-sort-controls">
                <select id="issue-sort" class="qa-select">
                  <option value="priority">Sort by Priority</option>
                  <option value="type">Sort by Type</option>
                  <option value="impact">Sort by Impact</option>
                </select>
              </div>
            </div>
          </div>
          <div class="qa-issues-list" id="issues-list">
            <!-- Issues will be populated here -->
          </div>
        </div>
      </div>
    </main>

    <!-- Enhanced Issue Detail Modal -->
    <div id="issue-detail-modal" class="qa-modal hidden">
      <div class="qa-modal-content">
        <div class="qa-modal-header">
          <h3 id="issue-detail-title">Issue Details</h3>
          <button id="close-modal" class="qa-btn qa-btn-ghost">√ó</button>
        </div>
        <div class="qa-modal-body">
          <div class="qa-issue-detail">
            <div class="qa-issue-meta">
              <span class="qa-issue-type" id="issue-detail-type">Token</span>
              <span class="qa-issue-severity" id="issue-detail-severity">Medium</span>
              <span class="qa-ai-confidence" id="issue-ai-confidence">Astra QA: 95%</span>
            </div>
            
            <!-- AI-Enhanced Description -->
            <div class="qa-issue-description">
              <div class="qa-description-basic" id="issue-basic-description">
                Basic issue description will appear here
              </div>
              <div class="qa-description-ai" id="issue-ai-description">
                Astra QA enhanced explanation will appear here
              </div>
            </div>
            
            <!-- Business Impact -->
            <div class="qa-issue-impact">
              <h4>üíº Business Impact</h4>
              <p id="issue-business-impact">Impact description will appear here</p>
            </div>
            
            <!-- Suggested Fix -->
            <div class="qa-issue-fix">
              <h4>üîß Suggested Fix</h4>
              <div class="qa-fix-tabs">
                <button class="qa-tab-btn active" data-tab="basic">Basic Fix</button>
                <button class="qa-tab-btn" data-tab="ai">Astra QA Recommendation</button>
              </div>
              <div class="qa-tab-content">
                <div class="qa-tab-pane active" data-tab="basic">
                  <div class="qa-code-block">
                    <code id="issue-basic-fix">CSS fix will appear here</code>
                  </div>
                </div>
                <div class="qa-tab-pane" data-tab="ai">
                  <div class="qa-ai-fix-content">
                    <p id="issue-ai-reasoning">Astra QA reasoning will appear here</p>
                    <div class="qa-code-block">
                      <code id="issue-ai-fix">Astra QA suggested implementation</code>
                    </div>
                  </div>
                </div>
              </div>
              <button id="copy-fix" class="qa-btn qa-btn-secondary">Copy Fix</button>
            </div>
            
            <!-- A/B Test Suggestion -->
            <div class="qa-ab-test" id="ab-test-suggestion" style="display: none;">
              <h4>üß™ A/B Test Opportunity</h4>
              <div class="qa-ab-content">
                <p id="ab-hypothesis">Test hypothesis will appear here</p>
                <div class="qa-ab-metrics">
                  <span class="qa-metric">Expected lift: <strong id="ab-expected-lift">15-25%</strong></span>
                  <span class="qa-metric">Confidence: <strong id="ab-confidence">High</strong></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced AI Settings Modal -->
    <div id="ai-settings-modal" class="qa-modal hidden">
      <div class="qa-modal-content">
        <div class="qa-modal-header">
          <h3>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12,2 22,8.5 22,15.5 12,22 2,15.5 2,8.5"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            Astra QA Settings
          </h3>
          <button id="close-ai-settings" class="qa-btn qa-btn-ghost">√ó</button>
        </div>
        <div class="qa-modal-body">
          <div class="qa-settings-form">
            <!-- AI Toggle -->
            <div class="qa-form-group">
              <label class="qa-toggle">
                <input type="checkbox" id="ai-enabled-toggle" checked>
                <span class="qa-toggle-slider"></span>
                Enable Astra QA AI Analysis
              </label>
              <p class="qa-form-help">Get intelligent insights and contextual recommendations powered by Claude AI</p>
            </div>
            
            <!-- Deployment Type Selection -->
            <div class="qa-form-group">
              <label for="deployment-type">Backend Deployment</label>
              <select id="deployment-type" class="qa-form-control">
                <option value="vercel">Vercel Serverless</option>
                <option value="local">Local Development</option>
              </select>
              <p class="qa-form-help">Choose where your Astra QA backend is deployed</p>
            </div>
            
            <!-- Vercel Deployment Fields -->
            <div id="vercel-deployment-fields" class="qa-deployment-fields">
              <div class="qa-form-group">
                <label for="vercel-url">Vercel Deployment URL</label>
                <input type="url" id="vercel-url" class="qa-form-control" 
                       placeholder="your-astra-qa.vercel.app or custom-domain.com">
                <p class="qa-form-help">
                  Your Astra QA Vercel deployment URL. You can find this in your Vercel dashboard after deployment.
                  <br><a href="#" onclick="window.open('https://vercel.com/docs/deployments/overview', '_blank')" class="qa-help-link">
                    üìö Learn about Vercel deployments
                  </a>
                </p>
              </div>
              
              <div class="qa-vercel-features">
                <h4>üöÄ Astra QA on Vercel</h4>
                <ul class="qa-feature-list">
                  <li>‚ö° Serverless & auto-scaling</li>
                  <li>üåç Global edge network</li>
                  <li>üí∞ Pay-per-use pricing</li>
                  <li>üîí Built-in security</li>
                  <li>üìä Analytics & monitoring</li>
                </ul>
              </div>
            </div>
            
            <!-- Local Deployment Fields -->
            <div id="local-deployment-fields" class="qa-deployment-fields" style="display: none;">
              <div class="qa-form-group">
                <label for="backend-url">Local Backend URL</label>
                <input type="url" id="backend-url" class="qa-form-control" 
                       value="http://localhost:3001" placeholder="http://localhost:3001">
                <p class="qa-form-help">URL of your local Astra QA development server</p>
              </div>
              
              <div class="qa-local-info">
                <h4>üñ•Ô∏è Local Development</h4>
                <p class="qa-info-text">
                  Running Astra QA locally? Make sure your backend server is started with <code>npm run dev</code>
                </p>
              </div>
            </div>
            
            <!-- Analysis Configuration -->
            <div class="qa-form-group">
              <label for="analysis-goal">Analysis Goal</label>
              <select id="analysis-goal" class="qa-form-control">
                <option value="general_improvement">General Improvement</option>
                <option value="conversion_optimization">Conversion Optimization</option>
                <option value="accessibility_focus">Accessibility Focus</option>
                <option value="brand_consistency">Brand Consistency</option>
                <option value="performance_impact">Performance Impact</option>
              </select>
            </div>
            
            <!-- Focus Areas -->
            <div class="qa-form-group">
              <label>Focus Areas</label>
              <div class="qa-checkbox-group">
                <label class="qa-checkbox">
                  <input type="checkbox" value="visual_hierarchy" name="focus-areas">
                  <span>Visual Hierarchy</span>
                </label>
                <label class="qa-checkbox">
                  <input type="checkbox" value="accessibility" name="focus-areas">
                  <span>Accessibility</span>
                </label>
                <label class="qa-checkbox">
                  <input type="checkbox" value="mobile_experience" name="focus-areas">
                  <span>Mobile Experience</span>
                </label>
                <label class="qa-checkbox">
                  <input type="checkbox" value="conversion_elements" name="focus-areas">
                  <span>Conversion Elements</span>
                </label>
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="qa-form-actions">
              <button id="save-ai-settings" class="qa-btn qa-btn-primary">
                üíæ Save Settings
              </button>
              <button id="test-ai-connection" class="qa-btn qa-btn-secondary">
                üîó Test Connection
              </button>
            </div>
            
            <!-- Connection Status -->
            <div id="ai-connection-status" class="qa-connection-status hidden">
              <span class="qa-status-icon">‚úÖ</span>
              <span>Astra QA service connected successfully</span>
            </div>
            
            <!-- Quick Setup Guide -->
            <div class="qa-setup-guide">
              <details>
                <summary>üìã Astra QA Setup Guide</summary>
                <div class="qa-setup-content">
                  <h4>üöÄ Deploy Astra QA to Vercel</h4>
                  <ol class="qa-setup-steps">
                    <li>Clone/download the Astra QA backend code</li>
                    <li>Get your <a href="https://console.anthropic.com" target="_blank">Anthropic API key</a></li>
                    <li>Deploy to Vercel: <code>vercel --prod</code></li>
                    <li>Set environment variable: <code>ANTHROPIC_API_KEY</code></li>
                    <li>Copy your deployment URL here</li>
                  </ol>
                  
                  <h4>üîß Local Development</h4>
                  <ol class="qa-setup-steps">
                    <li>Navigate to Astra QA server directory</li>
                    <li>Install dependencies: <code>npm install</code></li>
                    <li>Copy <code>.env.example</code> to <code>.env</code></li>
                    <li>Add your Anthropic API key to <code>.env</code></li>
                    <li>Start server: <code>npm run dev</code></li>
                  </ol>
                </div>
              </details>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>